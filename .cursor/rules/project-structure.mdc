---
description: 项目结构规范，定义 monorepo 组织方式、目录结构和命名约定
globs:
alwaysApply: true
---
# 项目结构规范

## 项目概述

本项目采用 **pnpm workspaces + Turbo** 的 monorepo 架构，包含以下核心组件：
- **Web 应用**：基于 Next.js 15 + React 19 的前端应用
- **共享 UI 包**：基于 shadcn/ui 的组件库
- **配置包**：共享的 ESLint 和 TypeScript 配置

## 根目录结构

```
expo-updates-admin/
├── apps/                    # 应用程序目录
│   └── web/                 # 前端 Web 应用（Next.js）
├── packages/                # 共享包目录
│   ├── ui/                  # shadcn/ui 组件库
│   ├── eslint-config/       # ESLint 配置包
│   └── typescript-config/   # TypeScript 配置包
├── pnpm-workspace.yaml      # pnpm 工作区配置
├── turbo.json               # Turbo 构建配置
├── package.json             # 根包配置
├── tsconfig.json            # 根 TypeScript 配置
└── README.md                # 项目说明
```

## 应用程序结构 (apps/)

### Web 应用结构 (apps/web/)

```
apps/web/
├── app/                     # Next.js App Router 目录
│   ├── layout.tsx          # 根布局组件
│   ├── page.tsx            # 首页
│   └── favicon.ico         # 网站图标
├── components/              # 应用级组件
│   └── providers.tsx       # 上下文提供者组件
├── hooks/                   # 自定义 Hooks
├── lib/                     # 工具库和配置
├── components.json          # shadcn/ui 配置
├── eslint.config.js        # ESLint 配置
├── next.config.mjs         # Next.js 配置
├── postcss.config.mjs      # PostCSS 配置
├── tsconfig.json           # TypeScript 配置
├── next-env.d.ts           # Next.js 类型定义
└── package.json            # 应用依赖配置
```

### 应用目录说明

- **`app/`**：使用 Next.js App Router，包含路由、布局和页面组件
- **`components/`**：应用特定的组件（不在 UI 包中共享的组件）
- **`hooks/`**：应用特定的自定义 Hooks
- **`lib/`**：应用特定的工具函数和配置

## 共享包结构 (packages/)

### UI 包结构 (packages/ui/)

```
packages/ui/
├── src/
│   ├── components/          # shadcn/ui 组件
│   │   └── button.tsx
│   ├── hooks/              # 共享 Hooks
│   ├── lib/                # 工具函数
│   │   └── utils.ts        # 工具函数（如 cn 函数）
│   └── styles/             # 全局样式
│       └── globals.css     # Tailwind CSS 全局样式
├── components.json         # shadcn/ui 配置
├── eslint.config.js        # ESLint 配置
├── postcss.config.mjs     # PostCSS 配置
├── tsconfig.json          # TypeScript 配置
├── tsconfig.lint.json     # 类型检查配置
└── package.json           # 包配置
```

### UI 包导出规范

UI 包通过 `package.json` 的 `exports` 字段导出：
- `./globals.css`：全局样式
- `./postcss.config`：PostCSS 配置
- `./lib/*`：工具函数
- `./components/*`：组件
- `./hooks/*`：Hooks

**使用示例**：
```typescript
import { Button } from "@workspace/ui/components/button"
import { cn } from "@workspace/ui/lib/utils"
```

### ESLint 配置包 (packages/eslint-config/)

```
packages/eslint-config/
├── base.js                 # 基础 ESLint 配置
├── next.js                 # Next.js 专用配置
├── react-internal.js       # React 内部规则配置
├── package.json            # 包配置
└── README.md               # 使用说明
```

### TypeScript 配置包 (packages/typescript-config/)

```
packages/typescript-config/
├── base.json               # 基础 TypeScript 配置
├── nextjs.json             # Next.js 专用配置
├── react-library.json      # React 库配置
├── package.json            # 包配置
└── README.md               # 使用说明
```

## 命名约定

### 包命名规范
- **应用包**：使用简单名称，如 `web`
- **共享包**：使用 `@workspace/{package-name}` 前缀
  - 示例：`@workspace/ui`、`@workspace/eslint-config`、`@workspace/typescript-config`

### 文件命名规范
- **组件文件**：使用 kebab-case，如 `app-navbar.tsx`、`user-profile.tsx`
- **工具文件**：使用 kebab-case，如 `api-client.ts`、`date-utils.ts`
- **配置文件**：使用标准名称，如 `next.config.mjs`、`turbo.json`、`package.json`
- **Next.js 路由**：遵循 App Router 约定，如 `layout.tsx`、`page.tsx`

### 目录命名规范
- **功能目录**：使用 kebab-case，如 `api-client`、`user-management`
- **源码目录**：统一使用 `src/`
- **应用目录**：Next.js App Router 使用 `app/`
- **组件目录**：使用复数形式，如 `components/`、`hooks/`
- **测试文件**：与源文件同目录，添加 `.test.` 或 `.spec.` 后缀

## 依赖管理

### 工作区配置
- 使用 `pnpm-workspace.yaml` 定义工作区范围：`apps/*` 和 `packages/*`
- 根目录 `package.json` 定义全局脚本和开发依赖
- 各应用/包独立管理自己的运行时依赖

### 内部依赖引用
- 使用 `workspace:*` 或 `workspace:^` 引用内部包
- 示例：
  ```json
  {
    "dependencies": {
      "@workspace/ui": "workspace:*",
      "@workspace/eslint-config": "workspace:^"
    }
  }
  ```

### Turbo 构建系统
- 使用 `turbo.json` 配置构建任务和依赖关系
- **构建任务**：`turbo build` - 按依赖顺序构建所有包
- **开发任务**：`turbo dev` - 并行启动开发服务器（不缓存）
- **代码检查**：`turbo lint` - 并行检查所有代码
- **类型检查**：通过 `turbo check-types` 检查类型（如果配置）

### 脚本约定
- **开发**：`pnpm run dev` - 通过 Turbo 启动开发服务器
- **构建**：`pnpm run build` - 通过 Turbo 构建所有应用
- **代码检查**：`pnpm run lint` - 通过 Turbo 检查所有代码
- **代码格式化**：`pnpm run format` - 格式化所有代码

## 配置管理

### TypeScript 配置
- 根目录 `tsconfig.json` 提供基础配置
- 各应用/包继承并扩展配置
- 使用 `@workspace/typescript-config` 共享配置
- 示例：
  ```json
  {
    "extends": "@workspace/typescript-config/nextjs.json"
  }
  ```

### ESLint 配置
- 使用 `@workspace/eslint-config` 共享配置
- 各应用可扩展或覆盖特定规则
- 支持多种配置：
  - `@workspace/eslint-config/base`：基础配置
  - `@workspace/eslint-config/next-js`：Next.js 专用配置
  - `@workspace/eslint-config/react-internal`：React 内部规则

### Next.js 配置
- 必须配置 `transpilePackages` 以支持 monorepo
- 示例：
  ```javascript
  const nextConfig = {
    transpilePackages: ["@workspace/ui"],
  }
  ```

### shadcn/ui 配置
- 在应用目录中创建 `components.json` 指向 UI 包
- 配置 `cwd` 指向 `packages/ui` 目录
- 组件会自动添加到 `packages/ui/src/components/` 目录

## 组件使用规范

### 从 UI 包导入组件
```typescript
// ✅ 正确：从 UI 包导入共享组件
import { Button } from "@workspace/ui/components/button"
import { cn } from "@workspace/ui/lib/utils"

// ❌ 错误：在应用目录中重复定义共享组件
```

### 组件分类
- **共享组件**：放在 `packages/ui/src/components/`，通过 shadcn/ui 添加
- **应用组件**：放在 `apps/web/components/`，特定于当前应用

### 全局样式
- 从 UI 包导入全局样式：
  ```typescript
  import "@workspace/ui/globals.css"
  ```

## 最佳实践

1. **模块化设计**：每个应用和包保持独立，减少耦合
2. **共享组件**：使用 shadcn/ui 添加到 UI 包，而非应用目录
3. **类型安全**：使用 TypeScript 和共享配置确保类型安全
4. **代码质量**：统一的 ESLint 配置和代码风格
5. **构建优化**：利用 Turbo 的缓存和并行构建提升性能
6. **依赖管理**：使用 `workspace:*` 确保内部包版本一致性
7. **文档维护**：保持 README 和代码注释的更新

## 工作流程

### 添加新的 shadcn/ui 组件
```bash
# 在项目根目录执行
pnpm dlx shadcn@latest add button -c apps/web
```

### 创建新包
1. 在 `packages/` 目录下创建新目录
2. 初始化 `package.json`，使用 `@workspace/{package-name}` 作为包名
3. 配置必要的依赖和导出
4. 在工作区中配置 ESLint 和 TypeScript

### 添加新应用
1. 在 `apps/` 目录下创建新目录
2. 初始化 Next.js 项目（或其他框架）
3. 配置 Turbo 任务
4. 引用必要的共享包

## 部署配置

### Web 应用部署
- 使用 `pnpm run build` 构建 Next.js 应用
- 输出目录：`.next/`
- 确保 Turbo 正确构建依赖的 UI 包
- 部署到 Vercel、Cloudflare Pages 或其他平台

### 环境变量
- 在应用目录中创建 `.env.local`（不提交到版本控制）
- 在 `.env.example` 中提供示例配置

## 开发注意事项

1. **Next.js Transpile**：确保 `next.config.mjs` 中配置了需要转译的包
2. **类型检查**：运行 `pnpm run typecheck` 检查所有包的类型
3. **Turbo 缓存**：开发任务不缓存，构建任务可缓存
4. **包导出**：UI 包必须正确配置 `exports` 字段
5. **样式导入**：确保在应用的根布局中导入全局样式
